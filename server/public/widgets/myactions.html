<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>StreamFinity | My Actions</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',system-ui,sans-serif;background:transparent;overflow:hidden;height:100vh;width:100vw}
.action{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;opacity:0;pointer-events:none;z-index:10}
.action.show{opacity:1;pointer-events:auto;animation:actionIn .6s cubic-bezier(.22,1,.36,1)}
.action.hide{animation:actionOut .4s ease forwards}
.action-card{padding:28px 40px;border-radius:20px;background:rgba(15,15,25,.85);-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);border:1px solid rgba(139,92,246,.3);box-shadow:0 0 60px rgba(139,92,246,.15),0 12px 40px rgba(0,0,0,.4)}
.action-icon{font-size:40px;margin-bottom:12px;animation:iconBounce .6s ease .2s both}
.action-text{font-size:28px;font-weight:800;background:linear-gradient(135deg,#a78bfa,#60a5fa,#34d399);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1.3}
.action-sub{font-size:14px;color:rgba(255,255,255,.5);margin-top:8px}
.action-user{color:#a78bfa;font-weight:600}
.action-ring{position:absolute;inset:-8px;border-radius:28px;border:2px solid rgba(139,92,246,.2);animation:ringPulse 1.5s ease infinite}
@keyframes actionIn{0%{opacity:0;transform:translate(-50%,-50%) scale(.6) translateY(20px)}100%{opacity:1;transform:translate(-50%,-50%) scale(1) translateY(0)}}
@keyframes actionOut{0%{opacity:1;transform:translate(-50%,-50%) scale(1)}100%{opacity:0;transform:translate(-50%,-50%) scale(.8) translateY(-20px)}}
@keyframes iconBounce{0%{transform:scale(0) rotate(-20deg)}60%{transform:scale(1.2) rotate(5deg)}100%{transform:scale(1) rotate(0)}}
@keyframes ringPulse{0%,100%{transform:scale(1);opacity:.3}50%{transform:scale(1.05);opacity:0}}
</style>
</head>
<body>
<div class="action" id="action">
    <div class="action-ring"></div>
    <div class="action-card">
        <div class="action-icon" id="actionIcon">âš¡</div>
        <div class="action-text" id="actionText"></div>
        <div class="action-sub" id="actionSub"></div>
    </div>
</div>
<script src="/widgets/sf-bridge.js"></script>
<script>
(function(){
'use strict';
var actionEl=document.getElementById('action');
var queue=[];var showing=false;
var icons=['âš¡','ðŸŽ¯','ðŸŽª','ðŸ”¥','ðŸ’¥','ðŸŽ­','ðŸŒŸ','ðŸŽ¬','ðŸš€','ðŸ’«'];

function showAction(text,sub,icon,duration,fade){queue.push({text:text,sub:sub,icon:icon,duration:duration||3500,fade:!!fade});if(!showing)processQueue();}
function processQueue(){
    if(!queue.length){showing=false;return;}
    showing=true;var d=queue.shift();
    document.getElementById('actionIcon').textContent=d.icon||icons[Math.floor(Math.random()*icons.length)];
    document.getElementById('actionText').textContent=d.text;
    document.getElementById('actionSub').innerHTML=d.sub||'';
    actionEl.style.transition=d.fade?'opacity .6s ease':'';
    actionEl.className='action show';
    setTimeout(function(){
        actionEl.className='action hide';
        setTimeout(function(){actionEl.className='action';processQueue();},500);
    },d.duration);
}

// Get this widget's screen from URL params
var params=new URLSearchParams(window.location.search);
var myScreen=parseInt(params.get('screen'))||1;

SF.on('action',function(d){
    // New RulesEngine format: d.screenId, d.action, d.triggerUser, d.triggerData
    if(d.screenId && parseInt(d.screenId)!==myScreen) return; // screen filter
    var action=d.action||d;
    var name=action.name||d.name||'Action!';
    var sub=d.description||'';
    if(d.triggerUser&&d.triggerUser.uniqueId) sub='Triggered by <span class="action-user">@'+d.triggerUser.uniqueId+'</span>';
    else if(d.uniqueId) sub='Triggered by <span class="action-user">@'+d.uniqueId+'</span>';
    var duration=(action.duration_seconds||3.5)*1000;
    var fade=action.fade_in_out||false;
    showAction(name,sub,d.icon,duration,fade);
});

if(SF.preview){
    var demoActions=[
        {text:'Dance!',sub:'Triggered by <span class="action-user">@GiftKing</span>',icon:'ðŸ’ƒ'},
        {text:'Drink Water!',sub:'Triggered by <span class="action-user">@HealthFan</span>',icon:'ðŸ’§'},
        {text:'Do 10 Push-ups!',sub:'Triggered by <span class="action-user">@FitViewer</span>',icon:'ðŸ’ª'},
        {text:'Shoutout!',sub:'Triggered by <span class="action-user">@BigSpender</span>',icon:'ðŸ“¢'},
    ];
    var idx=0;
    function demoLoop(){
        var a=demoActions[idx%demoActions.length];idx++;
        showAction(a.text,a.sub,a.icon);
        setTimeout(demoLoop,5000+Math.random()*2000);
    }
    setTimeout(demoLoop,1500);
}
})();
</script>
</body>
</html>
