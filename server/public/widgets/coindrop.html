<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>StreamFinity | Coin Drop</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:transparent;overflow:hidden;height:100vh;width:100vw;position:relative}
.coin{position:absolute;top:-50px;pointer-events:none;filter:drop-shadow(0 2px 6px rgba(0,0,0,.3));animation:fall linear forwards}
.coin img{width:100%;height:100%;object-fit:contain}
.coin-emoji{display:flex;align-items:center;justify-content:center}
.coin-glow{position:absolute;width:100%;height:100%;border-radius:50%;background:radial-gradient(circle,rgba(245,200,66,.3),transparent 70%);animation:pulse 1s ease infinite alternate}
@keyframes fall{0%{transform:translateY(0) rotate(0deg) scale(1);opacity:1}75%{opacity:1}100%{transform:translateY(110vh) rotate(var(--rot,540deg)) scale(.6);opacity:0}}
@keyframes pulse{0%{transform:scale(.8);opacity:.3}100%{transform:scale(1.2);opacity:.6}}
</style>
</head>
<body>
<script src="/widgets/sf-bridge.js"></script>
<script>
(function(){
'use strict';
var defaultEmojis=['ü™ô','üí∞','‚≠ê','üíé','üèÜ','‚ú®','üîÆ','üí´'];
var giftCatalog=[];
fetch('/api/gifts?limit=100').then(function(r){return r.json();}).then(function(d){
    giftCatalog=(d.gifts||d.data||[]).filter(function(g){return !g.isCreator;}).slice(0,50);
}).catch(function(){});

function dropCoin(imgUrl){
    var el=document.createElement('div');
    var size=24+Math.random()*28;
    var rot=360+Math.random()*720;
    var dur=2.5+Math.random()*2.5;
    el.className='coin';
    el.style.width=size+'px';el.style.height=size+'px';
    el.style.left=Math.random()*92+2+'%';
    el.style.setProperty('--rot',rot+'deg');
    el.style.animationDuration=dur+'s';
    if(imgUrl){
        el.innerHTML='<div class="coin-glow"></div><img src="'+imgUrl+'" alt="">';
    } else {
        el.className='coin coin-emoji';
        el.style.fontSize=size+'px';
        el.textContent=defaultEmojis[Math.floor(Math.random()*defaultEmojis.length)];
    }
    document.body.appendChild(el);
    setTimeout(function(){el.remove();},Math.ceil(dur*1000)+500);
}
function burst(count,imgUrl){
    var n=Math.min(count,30);
    for(var i=0;i<n;i++)(function(j){setTimeout(function(){dropCoin(imgUrl);},j*60);})(i);
}

SF.on('gift',function(d){
    var img=d.giftPictureUrl||null;
    if(!img&&giftCatalog.length){
        var g=giftCatalog.find(function(x){return x.name&&x.name.toLowerCase()===(d.giftName||'').toLowerCase();});
        if(g) img=g.image;
    }
    var count=Math.max(d.repeatCount||1,3);
    var diamonds=(d.diamondCount||1)*(d.repeatCount||1);
    if(diamonds>=100) count=Math.max(count,10);
    if(diamonds>=1000) count=Math.max(count,20);
    burst(count,img);
});
SF.on('follow',function(){burst(5,null);});

if(SF.preview){
    function demo(){
        var g=giftCatalog.length?giftCatalog[Math.floor(Math.random()*giftCatalog.length)]:null;
        burst(8,g?g.image:null);
        setTimeout(demo,3000+Math.random()*3000);
    }
    setTimeout(demo,1000);
}
burst(10,null);
})();
</script>
</body>
</html>
